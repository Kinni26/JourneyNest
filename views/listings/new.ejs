     <% layout("/layouts/boilerplate") %>
     <div class="row mt-3">
      <div class="col-8 offset-2">
        <br/><br/>
        <h3>Create a New Listing</h3>
    <form method="POST" action="/listings" novalidate 
    class="needs-validation" enctype="multipart/form-data">




      <div class="mb-3">
      <label for="title" class="form-label">Title</label>
      <input id="title" name="listing[title]" placeholder="Add a catchy title" type="text" 
      class="form-control"
      required
      />
      <div class="valid-feedback">Title looks good!</div>
      </div>


    <div class="mb-3">
      <label for="description" class="form-label">Description</label>
      <textarea
        name="listing[description]"
        class="form-control"
         required
      ></textarea>
       <div class="invalid-feedback">Please enter a short description!</div>
      </div>


       
      <div class="mb-3">
          <label for="image" class="form-label">Upload Listing Image</label>
      <input
        name="listing[image]"
        type="file"
        class="form-control"
        required
         />
      </div>


       <div class="row">
      <div class="mb-3 col-md-4">
       <label for="price" class="form-label">Price</label>
      <input name="listing[price]" placeholder="1200"   
      class="form-control" 
      required
       />
       <div class="invalid-feedback">Please enter a valid price!</div>
      </div>


      <div class="mb-3 col-md-8">
      <label for="country" class="form-label">Country</label>
      <input name="listing[country]" placeholder="India" type="text" 
      class="form-control"
      required
       />
       <div class="invalid-feedback">Please enter a valid country!</div>
      </div>
      </div>
      

     <div class="mb-3">
       <label for="location" class="form-label">Location</label>
      <input
        name="listing[location]"
        placeholder="Jaipur , Rajasthan"
        type="text"
        class="form-control"
         required
      />
      <div class="invalid-feedback">Please enter a valid location!</div>
      </div>
      


      

      <br/><br/>
      <button class="btn btn-dark add-btn mt-3">Add</button>
      <br/><br/>
    </form>


   <script>
document.getElementById("generateDescription").addEventListener("click", async () => {
  const location = document.getElementById("location").value;
  const type = document.getElementById("type").value;
  const amenities = document.getElementById("amenities").value.split(",").map(a => a.trim());

  const res = await fetch("/api/ai/generate-description", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ location, type, amenities })
  });

  const data = await res.json();
  document.getElementById("description").value = data.description || "AI failed";
});
</script>




    </div>
    </div>




  

 <!-- Leaflet CSS & JS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<div id="map" style="height: 300px; margin: 20px 0;"></div>

<script>
  // Default center: India
  const map = L.map('map').setView([20.5937, 78.9629], 5);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19
  }).addTo(map);

  let marker;

  const locationInput = document.querySelector('input[name="listing[location]"]');

  locationInput.addEventListener('change', async () => {
      const loc = locationInput.value;
      if (!loc) return;

      // Use Nominatim free API for geocoding
      const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${loc}`);
      const data = await res.json();
      if (data.length === 0) return;

      const lat = parseFloat(data[0].lat);
      const lon = parseFloat(data[0].lon);

      if (marker) {
          marker.setLatLng([lat, lon]);
      } else {
          marker = L.marker([lat, lon]).addTo(map);
      }

      map.setView([lat, lon], 13);
  });
</script>

<script>
    const locationBox = document.querySelector('input[name="listing[location]"]');

    locationBox.addEventListener("change", async () => {
        const loc = locationBox.value;
        if (!loc) return;

        const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${loc}`);
        const data = await res.json();
        if (data.length === 0) return;

        document.getElementById("lng").value = data[0].lon;
        document.getElementById("lat").value = data[0].lat;
    });
</script>


